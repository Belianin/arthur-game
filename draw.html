<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@700&display=swap" rel="stylesheet">
    <title>Пора рисовать</title>
</head>
<body>
    <div class="content">
        <h3>Пора рисовать!</h3>
        <canvas id="canvas" width="640" height="640"></canvas>
        <div>
            Сохрани свою картину --->
            <button id="save-button">Сохранить</button>
        </div>
    </div>
    <!-- <script type="module" src="js/draw.js"></script> -->
<script>
    let canvas;
    let isPressed = false;
    const pixelSize = 4;

    function onCanvasClick(event) {
        if (!isPressed)
            return;

        const context = canvas.getContext('2d');

        const rect = canvas.getBoundingClientRect();

        const x = alignCoordinate(event.pageX - rect.x);
        const y = alignCoordinate(event.pageY - rect.y);
        console.log(x + ":" + y);
        context.fillStyle = 'black';
        context.fillRect(x, y, pixelSize, pixelSize);
    }

    function alignCoordinate(number) {
        return Math.floor(number / pixelSize) * pixelSize;
    }

    function saveImage() {
        const link = document.createElement('a');
        link.download = 'picture.png';
        link.href = document.getElementById('canvas').toDataURL();
        link.click();
    }

    function onLoad() {
        canvas = document.getElementById('canvas');
        canvas.onmousemove = onCanvasClick;
        canvas.onmousedown = () => isPressed = !isPressed;
        canvas.onmouseup = () => isPressed = false;
        canvas.onmouseleave = () => isPressed = false;
        const context = canvas.getContext('2d');
        context.fillStyle = 'white';
        context.fillRect(0, 0, 640, 640);

        const saveButton = document.getElementById('save-button');
        saveButton.onclick = saveImage;
    }

    window.onload = onLoad;
</script>
</body>
</html>
